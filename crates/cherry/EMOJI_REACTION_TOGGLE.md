# Emoji ååº”åˆ‡æ¢åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

emoji ååº”åˆ‡æ¢åŠŸèƒ½å…è®¸ç”¨æˆ·é€šè¿‡ç‚¹å‡» emoji æ¥æ·»åŠ æˆ–åˆ é™¤å¯¹æ¶ˆæ¯çš„ååº”ã€‚å¦‚æœç”¨æˆ·å·²ç»å¯¹æŸä¸ª emoji åšå‡ºè¿‡ååº”ï¼Œå†æ¬¡ç‚¹å‡»ä¼šåˆ é™¤è¯¥ååº”ï¼›å¦‚æœæ²¡æœ‰ååº”è¿‡ï¼Œç‚¹å‡»ä¼šæ·»åŠ ååº”ã€‚

## å®ç°é€»è¾‘

### æ ¸å¿ƒå‡½æ•°

```typescript
const handleReactionClick = (msg: Message, emoji: string) => {
  if (!conversationId) return;
  
  // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹å‡»è¿‡è¿™ä¸ª emoji
  const existingReaction = msg.reactions?.find(r => r.emoji === emoji);
  const hasUserReacted = existingReaction?.users.includes(currentUserId);
  
  if (hasUserReacted) {
    // å¦‚æœç”¨æˆ·å·²ç»ç‚¹å‡»è¿‡ï¼Œåˆ™åˆ é™¤ååº”
    removeReaction(conversationId, msg.id, emoji, currentUserId);
  } else {
    // å¦‚æœç”¨æˆ·æ²¡æœ‰ç‚¹å‡»è¿‡ï¼Œåˆ™æ·»åŠ ååº”
    addReaction(conversationId, msg.id, emoji, currentUserId);
  }
};
```

### å·¥ä½œæµç¨‹

1. **æ£€æŸ¥ç°æœ‰ååº”** - æŸ¥æ‰¾æ¶ˆæ¯ä¸­æ˜¯å¦å·²æœ‰è¯¥ emoji çš„ååº”
2. **æ£€æŸ¥ç”¨æˆ·çŠ¶æ€** - æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨è¯¥ emoji çš„ç”¨æˆ·åˆ—è¡¨ä¸­
3. **æ‰§è¡Œæ“ä½œ** - æ ¹æ®ç”¨æˆ·çŠ¶æ€å†³å®šæ·»åŠ æˆ–åˆ é™¤ååº”

## æ•°æ®ç»“æ„

### Reaction æ¥å£

```typescript
export interface Reaction {
  emoji: string;
  users: string[]; // userId åˆ—è¡¨ï¼Œå¯é‡å¤
}
```

### æ¶ˆæ¯ä¸­çš„ååº”

```typescript
export interface Message {
  // ... å…¶ä»–å­—æ®µ
  reactions?: Reaction[];
}
```

## ä½¿ç”¨åœºæ™¯

### 1. ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡» emoji

**åˆå§‹çŠ¶æ€**ï¼š
```typescript
message.reactions = []
```

**ç”¨æˆ·æ“ä½œ**ï¼šç‚¹å‡» ğŸ‘

**ç»“æœ**ï¼š
```typescript
message.reactions = [
  { emoji: 'ğŸ‘', users: ['user1'] }
]
```

**UI æ˜¾ç¤º**ï¼šğŸ‘ 1

### 2. ç”¨æˆ·å†æ¬¡ç‚¹å‡»åŒä¸€ä¸ª emoji

**åˆå§‹çŠ¶æ€**ï¼š
```typescript
message.reactions = [
  { emoji: 'ğŸ‘', users: ['user1', 'user2'] }
]
```

**ç”¨æˆ·æ“ä½œ**ï¼šuser1 å†æ¬¡ç‚¹å‡» ğŸ‘

**ç»“æœ**ï¼š
```typescript
message.reactions = [
  { emoji: 'ğŸ‘', users: ['user2'] }
]
```

**UI æ˜¾ç¤º**ï¼šğŸ‘ 1

### 3. ç”¨æˆ·ç‚¹å‡»ä¸åŒçš„ emoji

**åˆå§‹çŠ¶æ€**ï¼š
```typescript
message.reactions = [
  { emoji: 'ğŸ‘', users: ['user1'] }
]
```

**ç”¨æˆ·æ“ä½œ**ï¼šç‚¹å‡» â¤ï¸

**ç»“æœ**ï¼š
```typescript
message.reactions = [
  { emoji: 'ğŸ‘', users: ['user1'] },
  { emoji: 'â¤ï¸', users: ['user1'] }
]
```

**UI æ˜¾ç¤º**ï¼šğŸ‘ 1 â¤ï¸ 1

### 4. å¤šä¸ªç”¨æˆ·å¯¹åŒä¸€ emoji ååº”

**åˆå§‹çŠ¶æ€**ï¼š
```typescript
message.reactions = [
  { emoji: 'ğŸ‘', users: ['user1'] }
]
```

**ç”¨æˆ·æ“ä½œ**ï¼šuser2 ç‚¹å‡» ğŸ‘

**ç»“æœ**ï¼š
```typescript
message.reactions = [
  { emoji: 'ğŸ‘', users: ['user1', 'user2'] }
]
```

**UI æ˜¾ç¤º**ï¼šğŸ‘ 2

## è§†è§‰åé¦ˆ

### ReactionIcon ç»„ä»¶

```typescript
<ReactionIcon
  key={r.emoji + r.users.length}
  active={r.users.includes(currentUserId)}
  onClick={() => handleReactionClick(message, r.emoji)}
  title={r.emoji}
>
  {r.emoji} {r.users.length > 1 ? r.users.length : ''}
</ReactionIcon>
```

### æ ·å¼å˜åŒ–

- **active çŠ¶æ€**ï¼šç”¨æˆ·å·²ååº”ï¼Œæ˜¾ç¤ºé«˜äº®æ ·å¼
- **é active çŠ¶æ€**ï¼šç”¨æˆ·æœªååº”ï¼Œæ˜¾ç¤ºæ™®é€šæ ·å¼
- **æ•°é‡æ˜¾ç¤º**ï¼šå½“ååº”æ•°é‡ > 1 æ—¶æ˜¾ç¤ºæ•°å­—

## æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•è¦†ç›–åœºæ™¯

1. **ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡» emoji** - éªŒè¯æ·»åŠ ååº”
2. **ç”¨æˆ·å†æ¬¡ç‚¹å‡»åŒä¸€ä¸ª emoji** - éªŒè¯åˆ é™¤ååº”
3. **ç”¨æˆ·ç‚¹å‡»ä¸åŒçš„ emoji** - éªŒè¯æ·»åŠ æ–°ååº”
4. **å…¶ä»–ç”¨æˆ·ç‚¹å‡»å·²æœ‰ååº”çš„ emoji** - éªŒè¯æ·»åŠ ååº”
5. **ç”¨æˆ·ç‚¹å‡»æ²¡æœ‰ååº”çš„æ¶ˆæ¯** - éªŒè¯æ·»åŠ ååº”

### è¿è¡Œæµ‹è¯•

```bash
npm run test:reaction
```

## åç«¯é›†æˆ

### ååº”æ¶ˆæ¯æ ¼å¼

æ·»åŠ ååº”æ—¶å‘é€çš„æ¶ˆæ¯ï¼š
```json
{
  "emoji": "ğŸ‘",
  "users": "user1",
  "action": "add",
  "targetMessageId": 123
}
```

åˆ é™¤ååº”æ—¶å‘é€çš„æ¶ˆæ¯ï¼š
```json
{
  "emoji": "ğŸ‘",
  "users": "user1",
  "action": "remove",
  "targetMessageId": 123
}
```

### æ¶ˆæ¯ç±»å‹

ååº”æ¶ˆæ¯ä½¿ç”¨ `type: 'reaction'` ç±»å‹ï¼Œåç«¯ä¼šå¤„ç†è¿™äº›æ¶ˆæ¯å¹¶æ›´æ–°ç›®æ ‡æ¶ˆæ¯çš„ååº”çŠ¶æ€ã€‚

## æ€§èƒ½è€ƒè™‘

### ä¼˜åŒ–ç‚¹

1. **æœ¬åœ°çŠ¶æ€æ›´æ–°** - ç«‹å³æ›´æ–° UIï¼Œä¸ç­‰å¾…åç«¯å“åº”
2. **é˜²é‡å¤ç‚¹å‡»** - åœ¨è¯·æ±‚æœŸé—´ç¦ç”¨æŒ‰é’®
3. **æ‰¹é‡æ›´æ–°** - å¤šä¸ªååº”åŒæ—¶æ›´æ–°æ—¶åˆå¹¶è¯·æ±‚

### é”™è¯¯å¤„ç†

1. **ç½‘ç»œé”™è¯¯** - å›æ»šæœ¬åœ°çŠ¶æ€
2. **æƒé™é”™è¯¯** - æ˜¾ç¤ºé”™è¯¯æç¤º
3. **æ•°æ®ä¸ä¸€è‡´** - é‡æ–°åŒæ­¥æ¶ˆæ¯çŠ¶æ€

## æ‰©å±•åŠŸèƒ½

### å¯èƒ½çš„å¢å¼º

1. **ååº”ç»Ÿè®¡** - æ˜¾ç¤ºæ¯ç§ååº”çš„è¯¦ç»†ç»Ÿè®¡
2. **ååº”å†å²** - æŸ¥çœ‹è°åœ¨ä»€ä¹ˆæ—¶å€™åšå‡ºäº†ååº”
3. **è‡ªå®šä¹‰ååº”** - æ”¯æŒè‡ªå®šä¹‰ emoji æˆ–å›¾ç‰‡
4. **ååº”é€šçŸ¥** - å½“æ¶ˆæ¯æ”¶åˆ°ååº”æ—¶é€šçŸ¥ç”¨æˆ·

## æ³¨æ„äº‹é¡¹

1. **å¹¶å‘å¤„ç†** - å¤šä¸ªç”¨æˆ·åŒæ—¶ååº”æ—¶çš„çŠ¶æ€åŒæ­¥
2. **æ•°æ®ä¸€è‡´æ€§** - ç¡®ä¿å‰ç«¯çŠ¶æ€ä¸åç«¯æ•°æ®ä¸€è‡´
3. **ç”¨æˆ·ä½“éªŒ** - æä¾›å³æ—¶çš„è§†è§‰åé¦ˆ
4. **æ€§èƒ½ä¼˜åŒ–** - é¿å…é¢‘ç¹çš„ DOM æ›´æ–°

## æ€»ç»“

emoji ååº”åˆ‡æ¢åŠŸèƒ½æä¾›äº†ç›´è§‚çš„äº¤äº’æ–¹å¼ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿè¡¨è¾¾å¯¹æ¶ˆæ¯çš„æ€åº¦ã€‚é€šè¿‡æ™ºèƒ½çš„åˆ‡æ¢é€»è¾‘ï¼Œé¿å…äº†é‡å¤ååº”ï¼Œæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ 